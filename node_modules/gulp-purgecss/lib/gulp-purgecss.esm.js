import e from"through2";import r from"plugin-error";import t from"glob";import n from"purgecss";export default function(o){return e.obj((async function(e,s,c){if(e.isNull())return c(null,e);if(e.isBuffer())try{const r={...o,content:(i=o.content,i.reduce((e,r)=>[...e,...t.sync(r)],[])),css:[{raw:e.contents.toString()}],stdin:!0},s=(await(new n).purge(r))[0],u=r.rejected&&s.rejected?s.rejected.join(" {}\n")+" {}":s.css;e.contents=Buffer.from(u,"utf-8"),c(null,e)}catch(e){this.emit("error",new r("gulp-purgecss",e.message))}var i;if(e.isStream()){const t=e;let s="";t.on("readable",e=>{s+=e.read().toString()}).on("end",async()=>{try{const r={...o,css:[s]},i=(await(new n).purge(r))[0],u=r.rejected&&i.rejected?i.rejected.join(" {}\n")+" {}":i.css;t.contents=Buffer.from(u,"utf-8"),c(null,e)}catch(e){this.emit("error",new r("gulp-purgecss",e.message))}})}}))}
